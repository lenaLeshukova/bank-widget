# bank-widget

## Описание:

Проект "bank-widget" - это виджет для личного кабинета клиента банка, который показывает несколько последних успешных банковских операций клиента, сортирует список транзакций клиента, маскирует данные карты и счета клиента. 

## Установка:

1. Клонируйте репозиторий:
```
git clone https://github.com/lenaLeshukova/bank-widget.git
```
2. Установите зависимости:
```
bash
pip install -r requirements.txt
```
3. Настройте переменные окружения:
```
Создайте файл .env в корневой папке.
Скопируйте содержимое из .env.example в .env.
Замените your_api_key_here на ваш реальный API ключ от apilayer.com
```
## Функции проекта, примеры работы:

* get_mask_card_number
```
Пример работы функции:
7000792289606361     # входной аргумент
7000 79** **** 6361  # выход функции
```
* get_mask_account
```
Пример работы функции:
73654108430135874305  # входной аргумент
**4305  # выход функции
```
* mask_account_card
```
Примеры работы функции
# Пример для карты
Visa Platinum 7000792289606361  # входной аргумент
Visa Platinum 7000 79** **** 6361  # выход функции
# Пример для счета
Счет 73654108430135874305  # входной аргумент
Счет **4305  # выход функции
```
* get_date
```
Принимает на вход строку с датой в формате 
"2024-03-11T02:26:18.671407"
 и возвращает строку с датой в формате 
"ДД.ММ.ГГГГ"
```
* filter_by_state
```
Примеры работы функции
# Выход функции со статусом по умолчанию 'EXECUTED'
[{'id': 41428829, 'state': 'EXECUTED', 'date': '2019-07-03T18:35:29.512364'}, {'id': 939719570, 'state': 'EXECUTED', 'date': '2018-06-30T02:08:58.425572'}]
# Выход функции, если вторым аргументов передано 'CANCELED'
[{'id': 594226727, 'state': 'CANCELED', 'date': '2018-09-12T21:27:25.241689'}, {'id': 615064591, 'state': 'CANCELED', 'date': '2018-10-14T08:21:33.419441'}]
``
 Выход функции (сортировка по убыванию, т. е. сначала самые последние операции)
[{'id': 41428829, 'state': 'EXECUTED', 'date': '2019-07-03T18:35:29.512364'}, {'id': 615064591, 'state': 'CANCELED', 'date': '2018-10-14T08:21:33.419441'}, {'id': 594226727, 'state': 'CANCELED', 'date': '2018-09-12T21:27:25.241689'}, {'id': 939719570, 'state': 'EXECUTED', 'date': '2018-06-30T02:08:58.425572'}]
```
* filter_by_currency
```
Функция принимает список словарей транзакций и код валюты (например, `"USD"` или `"RUB"`). Она возвращает **генератор**, который выдает только те транзакции, валюта которых совпадает с заданной.
Пример использования
transactions = [...]
usd_transactions = filter_by_currency(transactions, "USD")
for transaction in usd_transactions:
    print(transaction)
```
* transaction_descriptions(transactions)
```
Принимает список словарей с транзакциями и возвращает описание каждой операции по очереди.
Пример использования
transactions = [...]
descriptions = transaction_descriptions(transactions)
for _ in range(5):
    try:
        print(next(descriptions))
    except StopIteration:
        break
```
* card_number_generator(start, end)
```
Генератор, создающий последовательность номеров банковских карт в заданном числовом диапазоне. Номера форматируются в виде XXXX XXXX XXXX XXXX с ведущими нулями.
Пример использования:
for card_number in card_number_generator(1, 5):
    print(card_number)
    
# Вывод:
# 0000 0000 0000 0001
# 0000 0000 0000 0002
# 0000 0000 0000 0003
# 0000 0000 0000 0004
# 0000 0000 0000 0005
```
* get_financial_transactions(path)
```
Читает JSON-файл и возвращает список транзакций. Проверяет корректность данных (наличие файла, формат списка).
```
* get_transaction_amount(transaction)
```
Извлекает сумму транзакции. Если транзакция в USD или EUR, вызывает модуль конвертации.
```
* convert_to_rub(amount, currency)
```
Связывается с APILayer для получения актуального курса валют и конвертирует сумму в RUB.
```
* def read_transactions_csv(file_path: str)
```
Считывает финансовые операции из CSV-файла, возвращает список словарей.
```
* def read_transactions_excel(file_path: str)
```
Считывает финансовые операции из файла Excel, возвращает список словарей.
```
## Тестирование

Проект покрыт модульными тестами с использованием библиотеки `pytest`  и `unittest.mock`. Тесты проверяют корректность работы функций маскировки данных, фильтрации и сортировки банковских операций.
Успешное чтение и ошибки парсинга JSON.
Логику обработки различных валют.
Мокирование (замену) ответов внешнего API.

### Основные направления тестирования:
- **Маскировка (masks.py):** Проверка правильности скрытия цифр карт и счетов, валидация длины входных строк и обработка некорректных символов.
- **Обработка данных (processing.py):** Фильтрация транзакций по статусу (включая пустые списки и несуществующие статусы) и сортировка по дате (по возрастанию/убыванию).
- **Валидация:** Проверка обработки исключений (`ValueError`) при передаче неверных форматов данных.
- **Фильтрация по валюте (filter_by_currency):** Проверка корректной фильтрации транзакций по заданному коду (например, "USD").
Обработка случаев, когда искомая валюта отсутствует в списке.
Проверка поведения при получении пустого списка транзакций.
- **Описания транзакций (transaction_descriptions):**
Проверка последовательного вывода описаний операций.
Тестирование генератора на разном количестве входных данных (с использованием параметризации).
- **Генератор номеров карт (card_number_generator):**
Проверка корректности формирования строк в формате XXXX XXXX XXXX XXXX.
Тестирование граничных значений (минимальные и максимальные номера).
Проверка работы стоп-условия итератора.

### Тестирование декоратора
Тесты проверяют логирование в консоль, запись в файл, обработку исключений и сохранение метаданных функций.

- Вывод в консоль: использование фикстуры capsys для перехвата stdout и проверки сообщений "start" и "ok".
- Запись в файлы: использование фикстуры tmp_path для создания временных лог-файлов и проверки их содержимого.
- Логирование ошибок: проверка корректности записи типа исключения (например, ZeroDivisionError) и переданных аргументов (args, kwargs).
- Метаданные функции: проверка того, что @wraps корректно сохраняет __name__ и __doc__ декорируемой функции.

### Запуск тестов
Примечание: Тесты используют фикстуры и параметризацию для обеспечения чистоты кода и проверки различных граничных условий.

Для запуска всех тестов выполните команду:
```bash
pytest
* sort_by_date
```
Отчет о покрытии (Coverage)
Вы также можете проверить покрытие кода тестами (если установлена библиотека pytest-cov):
```
pytest --cov --cov-report=html
```
